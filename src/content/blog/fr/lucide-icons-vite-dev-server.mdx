---
title: Lucide-Icon üíî Vite dev server
description: Encore une histoire de bundle Javascript‚Ä¶
tags: [typescript, javascript, solid, lucide, vite, bundlers]
publishingDate: 2023-12-26
draft: false
slug: lucide-icons-avec-vite-dev-server
translation: lucide-icons-with-vite-dev-server
---

import { Image } from "astro:assets";

import badResults from "@/assets/lucide-icons-with-vite-dev-server/bad-results.png";
import goodResults from "@/assets/lucide-icons-with-vite-dev-server/good-results.png";
import meal from "@/assets/lucide-icons-with-vite-dev-server/meal.png";

On est sur un article super court. Ca sera genre, une petite histoire, suivie d‚Äôun fix, suivie d‚Äôune conclusion. Je vais essayer de garder ma frustration pour moi et m‚Äôen tenir aux faits ok? C‚Äôest pati.

## Contexte

Je bosse sur un nouveau projet. Pour ce projet je d√©cide d‚Äôenfin utiliser [SolidStart](https://start.solidjs.com/getting-started/what-is-solidstart), le m√©ta framework utilisant le tr√®s fameux [SolidJS](https://www.solidjs.com/). Tout se passe pour le mieux, j‚Äôappr√©cie fortement la techno. J‚Äôint√®gre mes designs avec brio, faisant preuve d‚Äôun comp√©tence hors-normes pour un lendemain de repas de No√´l.

<Image
  src={meal}
  alt="Repas de noel sur une table basse, riz, foie gras, saumon, crevettes"
/>

Arrive le moment o√π, je dois passer quelques minutes √† int√©grer des ic√¥nes. Je suis un dev moyen mais un tr√®s m√©diocre designer, et donc comme toujours, je fais appels aux excellentes ic√¥nes de [Lucide](https://lucide.dev/icons/). Je choppe le package compatible avec Solid et j‚Äôimporte ma premi√®re ic√¥ne:

```typescript
import { Twitch } from 'lucide-solid'

const MyComponent = () => {
  return <Button leftIcon={<Twitch />} />
}
```

Je sauvegarde mon fichier, j‚Äôouvre mon navigateur et l√†, il se passe‚Ä¶. bah rien genre. Enfin rien pendant 30 bonnes secondes, et puis ma page apparait. Je ne fais pas gaffe, je continue de bosser mais √† chaque fois que je reviens sur cette page en particulier, rien pour 30 secondes et ensuite mon contenu appara√Æt.

Pour tester, je compile mon app, et tout est ok sur la version de prod, mais la version de dev est toujours SUPER lente.

La frustration devient palpable, je d√©cide donc de stopper ce que je fais pour mener une petite enqu√™te. J‚Äôouvre mon onglet `Network`, je charge ma page et voici ce que je vois:

<Image
  src={badResults}
  alt="Screenshot de ChromeDevTools qui me montre que 1490 requ√™tes ont √©t√© faites"
/>

**MILLE QUATRE CENT QUATRE-VINGT DIX REQU√äTES!!!!!!!!!!!!** Le simple fait d‚Äôimporter une SEUL ic√¥ne foutait TOUTES les ic√¥nes de la librarie Lucide dans mon bundle de dev.

## Pourquoi?

Grosse question hein? [Des gens ont d√©j√† rencontr√© le probl√®me.](https://github.com/solidjs/solid-start/issues/1048)

La r√©ponse est plutot simple: le bundler Vite ne fait pas de tree-shaking en mode d√©veloppement et les gens ne sont pas super ok sur cette d√©cision de design [comme tu peux le voir ici](https://github.com/vitejs/vite/issues/8237). Je ne vais pas rentrer dans les d√©tails du pourquoi du comment du non tree-shaking et de la pertinence des barrels files (les fichiers ou t‚Äôexporte tout un tas de choses). Je vais juste dire que ESM est sens√© simplifier tout √ßa, mais faut croire que c'est encore trop t√¥t.

## Le fix

En trois √©tapes:

**Premi√®re √©tape**: Fait un alias entre un dossier virtuel au choix, et les sources de la lib lucide dans ton `vite.config.js`

```typescript
import { fileURLToPath, URL } from "node:url";
import { defineConfig } from "@solidjs/start/config";

export default defineConfig({
  resolve: {
    alias: {
      "lucide-solid/icons": fileURLToPath(
        new URL(
          "./node_modules/lucide-solid/dist/source/icons",
          import.meta.url,
        ),
      ),
    },
  },
});
```

**Deuxi√®me √©tape**: Fait comprendre √† typescript, dans `src/@types/lucide.d.ts`, qu‚Äôon va faire des choses bizarres et qu‚Äôil faut qu‚Äôil type tout ce qui est sous notre chemin virtuel en composant Solid.

```typescript
declare module "lucide-solid/icons/*" {
  import { LucideProps } from "lucide-solid/dist/types/types";
  import { Component } from "solid-js";
  const cmp: Component<LucideProps>;

  export = cmp;
}
```

**Troisi√®me √©tape**: Remplace les imports.

```typescript
import Twitch from 'lucide-solid/icon/twitch'

const MyComponent = () => {
  return <Button leftIcon={<Twitch />} />
}
```

**Quatri√®me √©tape**: Soit fi√®r(e) du dur labeur accompli.

<Image
  src={goodResults}
  alt="Screenshot de ChromeDevTools qui me montre que 124 requ√™tes sont maintenant fa√Ætes pour la m√™me page."
/>

## Pour finir

Quelques le√ßons:

- Les performances de ton environnement de d√©veloppement sont importantes. Si quelque chose ne fonctionne pas comme pr√©vu, fix le, tu gagneras du temps!
- Les arcanes du bunbling Javscript ne sont pas aussi simple qu‚Äôon peut le penser (en vrai personne ne pense que c‚Äôest simple).
- Vite n‚Äôest pas forc√©ment parfait. C‚Äôest une alternative √† Webpack et √ßa fait les choses d‚Äôune mani√®re diff√©rente. On peut parfois √™tre surpris!
