---
import { getCollection } from "astro:content";

import { t } from "@/i18n";
import Base from "@/layouts/Base.astro";
import ArticleCard from "@/components/ArticleCard.astro";
import Navbar from "@/components/Navbar.astro";
import IndexHeader from "@/components/IndexHeader.astro";
import IndexSectionList from "@/components/IndexSectionList.astro";
import { getArticleUrl } from "@/utils/link";

const blogCollection = await getCollection("blog", ({ data, id }) => {
  return (
    id.startsWith(Astro.currentLocale ?? "fr") &&
    Boolean(import.meta.env.DEV || !data.draft)
  );
}).then((data) =>
  data.toSorted((a, b) => {
    if (a.data.publishingDate > b.data.publishingDate) {
      return -1;
    } else if (a.data.publishingDate < b.data.publishingDate) {
      return 1;
    } else {
      return 0;
    }
  }),
);
---

<Base title={t("home:title")}>
  <Navbar />
  <IndexHeader />
  <IndexSectionList title={t("home:blogSectionTitle")}>
    {
      blogCollection.map((entry) => (
        <ArticleCard
          title={entry.data.title}
          date={entry.data.publishingDate}
          description={entry.data.description}
          tags={entry.data.tags}
          href={getArticleUrl(entry.id, entry.slug)}
        />
      ))
    }
  </IndexSectionList>
</Base>
